# Ecommerce Store Template Repository Structure

This document describes how to structure your ecommerce store template repository for use with the Storely Agent platform.

## Repository Structure

Your template repository should have the following structure:

```
your-store-templates-repo/
├── deploy_templates.sh          # Required: Deployment script
├── template_catalog.json         # Required: Template catalog metadata
├── templates/                    # Template source directories
│   └── base-store/               # Your base ecommerce template
│       ├── package.json          # Required: Dependencies
│       ├── .donttouch_files.json # Optional: Files that shouldn't be modified
│       ├── .redacted_files.json  # Optional: Files to hide from AI
│       ├── .important_files.json # Optional: Important files to highlight
│       └── [all your template files]
└── zips/                         # Optional: Pre-built zip files (or generated by deploy script)
    └── base-store.zip
```

## Required Files

### 1. `deploy_templates.sh` (Required)

This script is executed by the deployment system to upload templates to R2. It should:

- Read environment variables: `BUCKET_NAME` (or `R2_BUCKET_NAME`), `CLOUDFLARE_API_TOKEN`, `CLOUDFLARE_ACCOUNT_ID`
- Build template zip files from source directories
- Upload `template_catalog.json` to R2
- Upload each template zip file to R2

**Example structure:**
```bash
#!/bin/bash
set -e

BUCKET_NAME=${BUCKET_NAME:-${R2_BUCKET_NAME}}
if [ -z "$BUCKET_NAME" ]; then
    echo "Error: BUCKET_NAME or R2_BUCKET_NAME must be set"
    exit 1
fi

# Upload template catalog
wrangler r2 object put "$BUCKET_NAME/template_catalog.json" \
    --file=./template_catalog.json \
    --content-type="application/json"

# Build and upload each template
for template_dir in templates/*/; do
    template_name=$(basename "$template_dir")
    echo "Building and uploading $template_name..."
    
    # Create zip file
    cd "$template_dir"
    zip -r "../../zips/${template_name}.zip" . -x "*.git*" -x "node_modules/*"
    cd ../..
    
    # Upload to R2
    wrangler r2 object put "$BUCKET_NAME/${template_name}.zip" \
        --file="./zips/${template_name}.zip" \
        --content-type="application/zip"
done

echo "✅ Templates deployed successfully"
```

### 2. `template_catalog.json` (Required)

This file lists all available templates with their metadata. It's uploaded to R2 and read by the system.

**Structure:**
```json
[
  {
    "name": "base-store",
    "language": "typescript",
    "frameworks": ["react", "vite", "tailwindcss"],
    "description": {
      "selection": "A comprehensive base ecommerce store template with product catalog, shopping cart, checkout flow, and admin dashboard. Perfect for building any type of online store - fashion, electronics, general retail, or specialized ecommerce applications. Includes authentication, payment integration hooks, inventory management, and responsive design.",
      "usage": "This is our base ecommerce store template. It provides a complete foundation for building online stores with:\n- Product catalog with categories and filters\n- Shopping cart functionality\n- Checkout process\n- User authentication\n- Admin dashboard for product management\n- Responsive design optimized for all devices\n\nYou can customize this template for any ecommerce use case. The template uses React, Vite, TypeScript, and Tailwind CSS. All SHADCN components are pre-installed in ./src/components/ui/* and can be imported and used directly.\n\n**DO NOT TOUCH FILES:**\n- package.json\n- vite.config.ts\n- wrangler.jsonc\n- tsconfig.json\n\n**REDACTED FILES:**\n- .env files (if any)\n- Private keys or secrets"
    }
  }
]
```

**Field Descriptions:**

- `name` (required): Unique template identifier (used as filename: `{name}.zip`)
- `language` (optional): Primary language (e.g., "typescript", "javascript")
- `frameworks` (optional): Array of frameworks used (e.g., ["react", "vite", "tailwindcss"])
- `description.selection` (required): Description used by AI to select templates. Should describe:
  - What the template is for
  - Key features and capabilities
  - Best use cases
  - What makes it suitable for ecommerce
- `description.usage` (required): Instructions for developers using the template. Should include:
  - What the template provides
  - How to use it
  - Important files/components
  - DO NOT TOUCH files list
  - REDACTED files list (if any)

### 3. Template Directory Structure

Each template should be in its own directory under `templates/`:

```
templates/base-store/
├── package.json              # Required: Must include all dependencies
├── vite.config.ts            # Or other build config
├── tsconfig.json             # TypeScript config
├── tailwind.config.js        # Tailwind config
├── index.html                # Entry HTML
├── src/
│   ├── main.tsx              # Entry point
│   ├── App.tsx                # Main app component
│   ├── components/
│   │   └── ui/               # SHADCN components (if used)
│   └── [your app structure]
├── .donttouch_files.json     # Optional: Files that shouldn't be modified
├── .redacted_files.json      # Optional: Files to hide from AI context
└── .important_files.json     # Optional: Important files to highlight
```

### 4. Optional Metadata Files

#### `.donttouch_files.json`
List of files that should never be modified by the AI:
```json
[
  "package.json",
  "vite.config.ts",
  "wrangler.jsonc",
  "tsconfig.json"
]
```

#### `.redacted_files.json`
List of files that exist but should be hidden from AI (for security):
```json
[
  ".env",
  ".env.local",
  "secrets.json"
]
```

#### `.important_files.json`
List of important files to highlight to the AI:
```json
[
  "src/components/ProductCard.tsx",
  "src/hooks/useCart.ts",
  "src/store/cartStore.ts"
]
```

## Template Zip File Requirements

When the template is zipped and uploaded to R2:

1. **Zip filename**: Must match template name: `{template_name}.zip` (e.g., `base-store.zip`)
2. **Root structure**: All files should be at the root of the zip (not in a subdirectory)
3. **Required files**: Must include `package.json` at minimum
4. **Exclusions**: Should exclude:
   - `.git/` directory
   - `node_modules/` directory
   - Build artifacts
   - `.env` files

## Deployment Process

When you deploy:

1. The system clones your repository
2. Runs `deploy_templates.sh` with environment variables:
   - `BUCKET_NAME` or `R2_BUCKET_NAME`: The R2 bucket name
   - `CLOUDFLARE_API_TOKEN`: API token for R2 access
   - `CLOUDFLARE_ACCOUNT_ID`: Your Cloudflare account ID
3. The script should:
   - Upload `template_catalog.json` to R2
   - Build zip files for each template
   - Upload each `{template_name}.zip` to R2

## Example: Single Base Template Setup

For your current setup with one base template:

**template_catalog.json:**
```json
[
  {
    "name": "base-store",
    "language": "typescript",
    "frameworks": ["react", "vite", "tailwindcss", "react-router", "hono", "cloudflare-workers"],
    "description": {
      "selection": "A comprehensive full-stack ecommerce store template with customer storefront, admin dashboard, and Cloudflare Workers backend API. Perfect for building any type of online store - fashion, electronics, general retail, or specialized ecommerce applications. Includes product catalog, shopping cart, checkout flow with Stripe integration, order management, payment tracking, and D1 database schema. Built with React 19, TypeScript, Vite, Tailwind CSS, and Hono on Cloudflare Workers.",
      "usage": "This is the base ecommerce store template. It provides a complete full-stack foundation for building online stores.\n\n**Project Structure:**\n```\nbase-store/\n├── src/                    # Customer-facing storefront (main app)\n│   ├── App.tsx             # Main app with routing\n│   ├── main.tsx            # Entry point\n│   ├── index.css           # Global styles (Tailwind)\n│   ├── api/                # API client\n│   ├── components/         # Reusable components\n│   ├── context/            # React context (Cart)\n│   └── pages/              # Page components\n├── admin-app/              # Admin dashboard (React + Vite)\n│   ├── src/\n│   │   ├── App.tsx\n│   │   ├── api/\n│   │   ├── components/\n│   │   ├── context/\n│   │   └── pages/\n│   └── [config files]\n├── api-worker/             # Cloudflare Workers API (Hono)\n│   ├── src/\n│   │   ├── index.ts        # API entry point\n│   │   ├── middleware/     # Auth, store resolver\n│   │   ├── routes/         # API routes\n│   │   └── types.ts\n│   └── wrangler.toml\n├── infra/\n│   └── db/\n│       ├── schema.sql      # D1 database schema\n│       └── seed.sql        # Sample data\n└── public/                 # Static assets\n```\n\n**Storefront Features (Main App):**\n- Product catalog with grid views and search\n- Shopping cart with local storage persistence\n- Product detail pages with add-to-cart\n- Checkout process with Stripe integration hooks\n- Success/confirmation page\n- Responsive design with warm cream palette\n\n**Admin Dashboard Features (admin-app/):**\n- Dashboard with key metrics and statistics\n- Product management (CRUD operations)\n- Order management and tracking\n- Payment monitoring\n- Dark theme with responsive sidebar\n\n**Edge API Features (api-worker/):**\n- RESTful API built with Hono\n- Store resolution middleware\n- Authentication middleware\n- Product, order, and webhook routes\n- D1 database integration\n\n**Tech Stack:**\n- React 19 with TypeScript\n- Vite for build tooling\n- Tailwind CSS for styling\n- React Router for navigation\n- Hono for API routing\n- Cloudflare Workers & D1\n- Lucide React for icons\n\n**DO NOT TOUCH FILES:**\n- package.json\n- vite.config.ts\n- tsconfig.json / tsconfig.app.json / tsconfig.node.json\n- tailwind.config.js / tailwind.config.cjs\n- postcss.config.cjs\n- eslint.config.js\n- admin-app/[config files]\n- api-worker/package.json\n- api-worker/wrangler.toml\n- infra/db/schema.sql (structure)\n\n**Running Locally:**\n```bash\nnpm install\nnpm run db:init   # Initialize D1 database\nnpm run db:seed   # Seed with sample data\nnpm run dev       # Start storefront (main app)\nnpm run dev:admin # Start admin dashboard\nnpm run dev:api   # Start API worker\n```\n\n**API Integration:**\nApps use environment variables:\n- VITE_API_URL (default: http://localhost:8787)\n- VITE_STORE_SLUG (default: demo-store)\n\n**Database:**\nD1 schema in infra/db/schema.sql includes:\n- stores, products, orders, order_items, payments tables\n\nCustomize this template for your specific ecommerce needs."
    }
  }
]
```

## Adding More Templates Later

When you add more specialized templates (e.g., `store-fashion`, `store-electronics`), simply:

1. Add a new directory: `templates/store-fashion/`
2. Add entry to `template_catalog.json`
3. Update `deploy_templates.sh` if needed (should work automatically)
4. Deploy - the new template will be available

## Testing Your Template

Before deploying:

1. **Test locally**: Create a zip manually and verify structure
2. **Verify catalog**: Check `template_catalog.json` is valid JSON
3. **Check metadata files**: Ensure optional JSON files are valid
4. **Test deployment script**: Run `deploy_templates.sh` locally with test credentials

## Important Notes

- Template names must be unique and URL-safe (lowercase, hyphens, underscores)
- The `description.selection` field is critical - it's what the AI uses to select templates
- The `description.usage` field helps developers understand how to use the template
- Zip files should be optimized (exclude unnecessary files)
- All dependencies must be listed in `package.json`
- The template should be a working, runnable application


